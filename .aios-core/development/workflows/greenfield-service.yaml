workflow:
  id: greenfield-service
  name: Greenfield Service/API Development
  version: "1.0"
  description: >-
    Agent workflow for building backend services from concept to development.
    Supports both comprehensive planning for complex services and rapid prototyping for simple APIs.
  type: greenfield
  project_types:
    - rest-api
    - graphql-api
    - microservice
    - backend-service
    - api-prototype
    - simple-service

  metadata:
    elicit: true
    confirmation_required: true

  phases:
    - phase_1: Discovery & Planning
    - phase_2: Document Sharding
    - phase_3: Development Cycle

  sequence:
    # ═══════════════════════════════════════════════════════════════════════════
    # PHASE 1: DISCOVERY & PLANNING
    # ═══════════════════════════════════════════════════════════════════════════
    - phase: 1
      name: Discovery & Planning
      description: "Create all planning artifacts (project brief, PRD, architecture)"

    - id: analyst-project-brief
      agent: analyst
      creates: project-brief.md
      duration_estimate: "30-60 min"
      optional_steps:
        - brainstorming-session
        - market-research-prompt
      notes: "Can do brainstorming first, then optional deep research before creating project brief. SAVE OUTPUT: Copy final project-brief.md to your project's docs/ folder."

    - id: pm-create-prd
      agent: pm
      creates: prd.md
      duration_estimate: "30-60 min"
      requires: project-brief.md
      notes: "Creates PRD from project brief using prd-tmpl, focused on API/service requirements. SAVE OUTPUT: Copy final prd.md to your project's docs/ folder."

    - id: architect-create-architecture
      agent: architect
      creates: architecture.md
      duration_estimate: "30-60 min"
      requires: prd.md
      optional_steps:
        - technical-research-prompt
      notes: "Creates backend/service architecture using architecture-tmpl. May suggest changes to PRD stories or new stories. SAVE OUTPUT: Copy final architecture.md to your project's docs/ folder."

    - id: pm-update-prd
      agent: pm
      updates: prd.md
      duration_estimate: "15-30 min"
      requires: architecture.md
      condition: architecture_suggests_prd_changes
      notes: "If architect suggests story changes, update PRD and re-export the complete unredacted prd.md to docs/ folder."

    - id: po-validate-artifacts
      agent: po
      validates: all_artifacts
      uses: po-master-checklist
      duration_estimate: "15-30 min"
      notes: "Validates all documents for consistency and completeness. May require updates to any document."

    - id: po-delegate-fixes
      agent: po
      action: delegate_fixes
      delegates_to: [analyst, pm, architect]
      updates: any_flagged_documents
      duration_estimate: "15-30 min"
      condition: po_checklist_issues
      returns_to: po-validate-artifacts
      notes: "If PO finds issues, PO delegates fixes to the relevant agent. After fixes are applied, returns to po-validate-artifacts for re-validation before proceeding to Phase 2."

    # ═══════════════════════════════════════════════════════════════════════════
    # PHASE 2: DOCUMENT SHARDING
    # ═══════════════════════════════════════════════════════════════════════════
    - phase: 2
      name: Document Sharding
      description: "Break down PRD and architecture into development-ready chunks"

    - id: po-shard-documents
      agent: po
      action: shard_documents
      creates: sharded_docs
      duration_estimate: "15-30 min"
      requires:  # all validated artifacts must be saved in project docs/ folder
        - prd.md
        - architecture.md
      notes: |
        Shard documents for IDE development:
        - Option A: Use PO agent to shard: @po then ask to shard docs/prd.md
        - Option B: Manual: Drag shard-doc task + docs/prd.md into chat
        - Creates docs/prd/ and docs/architecture/ folders with sharded content

    # ═══════════════════════════════════════════════════════════════════════════
    # PHASE 3: DEVELOPMENT CYCLE
    # ═══════════════════════════════════════════════════════════════════════════
    - phase: 3
      name: Development Cycle
      description: "Iterative story implementation with QA review"

    - id: sm-create-story
      agent: sm
      action: create_story
      creates: story.md
      duration_estimate: "15-30 min"
      requires: sharded_docs
      repeats: for_each_epic
      notes: |
        Story creation cycle:
        - SM Agent (New Chat): @sm → *create
        - Creates next story from sharded docs
        - Story starts in "Draft" status

    - id: pm-review-draft-story
      agent: pm
      action: review_draft_story
      alternative_agent: analyst
      updates: story.md
      duration_estimate: "10-20 min"
      requires: story.md
      optional: true
      condition: user_wants_story_review
      notes: |
        OPTIONAL: Review and approve draft story
        - NOTE: story-review task coming soon
        - Review story completeness and alignment
        - Update story status: Draft → Approved

    - id: dev-implement-story
      agent: dev
      action: implement_story
      creates: implementation_files
      duration_estimate: "1-4 hours"
      requires: story.md
      notes: |
        Dev Agent (New Chat): @dev
        - Implements approved story
        - Updates File List with all changes
        - Marks story as "Review" when complete

    - id: qa-review-implementation
      agent: qa
      action: review_implementation
      updates: implementation_files
      duration_estimate: "20-40 min"
      requires: implementation_files
      optional: true
      notes: |
        OPTIONAL: QA Agent (New Chat): @qa → review-story
        - Senior dev review with refactoring ability
        - Fixes small issues directly
        - Leaves checklist for remaining items
        - Updates story status (Review → Done or stays Review)

    - id: dev-address-qa-feedback
      agent: dev
      action: address_qa_feedback
      updates: implementation_files
      requires: implementation_files
      duration_estimate: "30-60 min"
      condition: qa_left_unchecked_items
      notes: |
        If QA left unchecked items:
        - Dev Agent (New Chat): Address remaining items
        - Return to QA for final approval

    - meta: repeat
      target_steps: [sm-create-story, dev-implement-story, qa-review-implementation]
      condition: stories_remaining
      notes: |
        Repeat story cycle (SM → Dev → QA) for all epic stories
        Continue until all stories in PRD are complete

    - id: po-epic-retrospective
      agent: po
      action: epic_retrospective
      creates: epic-retrospective.md
      duration_estimate: "15-30 min"
      condition: epic_complete
      optional: true
      notes: |
        OPTIONAL: After epic completion
        - NOTE: epic-retrospective task coming soon
        - Validate epic was completed correctly
        - Document learnings and improvements

    - meta: end
      action: project_complete
      notes: |
        All stories implemented and reviewed!
        Service development phase complete.
        Reference: .aios-core/data/aios-kb.md#IDE Development Workflow

  flow_diagram: |
    ```mermaid
    graph TD
        A[Start: Service Development] --> B[analyst: project-brief.md]
        B --> C[pm: prd.md]
        C --> D[architect: architecture.md]
        D --> E{Architecture suggests PRD changes?}
        E -->|Yes| F[pm: update prd.md]
        E -->|No| G[po: validate all artifacts]
        F --> G
        G --> H{PO finds issues?}
        H -->|Yes| I[po: delegate fixes to relevant agent]
        H -->|No| J[po: shard documents]
        I --> G

        J --> K[sm: create story]
        K --> L{Review draft story?}
        L -->|Yes| M[pm/analyst: review & approve story]
        L -->|No| N[dev: implement story]
        M --> N
        N --> O{QA review?}
        O -->|Yes| P[qa: review implementation]
        O -->|No| Q{More stories?}
        P --> R{QA found issues?}
        R -->|Yes| S[dev: address QA feedback]
        R -->|No| Q
        S --> P
        Q -->|Yes| K
        Q -->|No| T{Epic retrospective?}
        T -->|Yes| U[po: epic retrospective]
        T -->|No| V[Project Complete]
        U --> V

        B -.-> B1[Optional: brainstorming]
        B -.-> B2[Optional: market research]
        D -.-> D1[Optional: technical research]

        style V fill:#90EE90
        style J fill:#ADD8E6
        style K fill:#ADD8E6
        style N fill:#ADD8E6
        style B fill:#FFE4B5
        style C fill:#FFE4B5
        style D fill:#FFE4B5
        style M fill:#F0E68C
        style P fill:#F0E68C
        style U fill:#F0E68C
    ```

  decision_guidance:
    when_to_use:
      - Building production APIs or microservices
      - Multiple endpoints and complex business logic
      - Need comprehensive documentation and testing
      - Multiple team members will be involved
      - Long-term maintenance expected
      - Enterprise or external-facing APIs
    when_not_to_use:
      - Simple CRUD API with fewer than 3 endpoints (use rapid prototyping)
      - Adding features to existing service (use brownfield-service)
      - Full-stack application with frontend (use greenfield-fullstack)
      - Frontend-only project (use greenfield-ui)
      - Technical debt assessment on existing project (use brownfield-discovery)

  handoff_prompts:
    analyst_to_pm: "Project brief is complete. Save it as docs/project-brief.md in your project, then create the PRD."
    pm_to_architect: "PRD is ready. Save it as docs/prd.md in your project, then create the service architecture."
    architect_review: "Architecture complete. Save it as docs/architecture.md. Do you suggest any changes to the PRD stories or need new stories added?"
    architect_to_pm: "Please update the PRD with the suggested story changes, then re-export the complete prd.md to docs/."
    updated_to_po: "All documents ready in docs/ folder. Please validate all artifacts for consistency."
    po_issues: "PO found issues with [document]. Please return to [agent] to fix and re-save the updated document."
    complete: "All planning artifacts validated and saved in docs/ folder. Move to IDE environment to begin development."
